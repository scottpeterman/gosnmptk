
<!-- templates/report.html -->
{% extends "base.html" %}

{% block title %}Scanner Report - {{ filename }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">üìÅ Scanner Files</a> / üìä {{ filename }}
</div>

<div class="header">
    <h1>üìä Network Analysis Report</h1>
    <p>Analysis for: <strong>{{ filename }}</strong></p>
    <div style="margin-top: 15px;">
        <a href="{{ url_for('export_csv', filename=request.view_args.filename) }}" class="cyber-button primary">
            üì• Export Full CSV Report
        </a>
        <a href="{{ url_for('index') }}" class="cyber-button">
            ‚Üê Back to Files
        </a>
    </div>
</div>

<!-- Key Metrics -->
<div class="card">
    <div class="card-title">üìà Key Metrics</div>
    <div class="grid grid-4">
        <div class="metric-card">
            <div class="metric-value">{{ stats.total_devices }}</div>
            <div class="metric-label">Total Devices</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ stats.snmp_ready }}</div>
            <div class="metric-label">SNMP Ready</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ stats.responding }}</div>
            <div class="metric-label">Responding</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ "%.1f"|format(stats.avg_confidence) }}%</div>
            <div class="metric-label">Avg Confidence</div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-2">
    <!-- Vendor Distribution -->
    <div class="card">
        <div class="card-title">üè¢ Vendor Distribution</div>
        <div class="chart-container">
            <canvas id="vendorChart"></canvas>
        </div>
    </div>

    <!-- Device Types -->
    <div class="card">
        <div class="card-title">üñ•Ô∏è Device Types</div>
        <div class="chart-container">
            <canvas id="typeChart"></canvas>
        </div>
    </div>
</div>

<!-- Vendor Breakdown Table -->
<div class="card">
    <div class="card-title">üè≠ Vendor Breakdown</div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Vendor</th>
                    <th>Device Count</th>
                    <th>Percentage</th>
                    <th>Market Share</th>
                </tr>
            </thead>
            <tbody>
                {% for vendor, count in stats.vendor_breakdown.items() | sort(attribute=1, reverse=true) %}
                <tr>
                    <td><strong>{{ vendor.title() }}</strong></td>
                    <td>{{ count }}</td>
                    <td>{{ "%.1f"|format((count / stats.total_devices) * 100) }}%</td>
                    <td>
                        <div style="background: rgba(34, 211, 238, 0.2); height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #22d3ee, #0ea5e9); height: 100%; width: {{ (count / stats.total_devices) * 100 }}%; border-radius: 10px; transition: width 0.5s ease;"></div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Device Types Breakdown -->
<div class="card">
    <div class="card-title">‚öôÔ∏è Device Types Breakdown</div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Device Type</th>
                    <th>Count</th>
                    <th>Percentage</th>
                    <th>Distribution</th>
                </tr>
            </thead>
            <tbody>
                {% for device_type, count in stats.device_type_breakdown.items() | sort(attribute=1, reverse=true) %}
                <tr>
                    <td><strong>{{ device_type.replace('_', ' ').title() }}</strong></td>
                    <td>{{ count }}</td>
                    <td>{{ "%.1f"|format((count / stats.total_devices) * 100) }}%</td>
                    <td>
                        <div style="background: rgba(14, 165, 233, 0.2); height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #0ea5e9, #22d3ee); height: 100%; width: {{ (count / stats.total_devices) * 100 }}%; border-radius: 10px; transition: width 0.5s ease;"></div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Subnet Distribution -->
<div class="card">
    <div class="card-title">üåê Network Subnet Distribution</div>
    <div class="grid grid-3">
        {% for subnet, count in stats.subnet_breakdown.items() | sort(attribute=1, reverse=true) %}
        <div class="metric-card">
            <div class="metric-value">{{ count }}</div>
            <div class="metric-label">{{ subnet }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Scan Information -->
<div class="card">
    <div class="card-title">üìÖ Scan Information</div>
    <div class="grid grid-2">
        <div>
            <h4 style="color: #0ea5e9;">Last Scan:</h4>
            <p>{{ stats.last_scan if stats.last_scan else 'N/A' }}</p>
        </div>
        <div>
            <h4 style="color: #0ea5e9;">First Scan:</h4>
            <p>{{ stats.first_scan if stats.first_scan else 'N/A' }}</p>
        </div>
    </div>
</div>

<script>
// Chart.js configuration with cyberpunk theme
Chart.defaults.color = '#22d3ee';
Chart.defaults.borderColor = 'rgba(34, 211, 238, 0.2)';

// Vendor Distribution Chart
const vendorData = {{ stats.vendor_breakdown | tojson }};
const vendorLabels = Object.keys(vendorData);
const vendorValues = Object.values(vendorData);

new Chart(document.getElementById('vendorChart'), {
    type: 'doughnut',
    data: {
        labels: vendorLabels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
        datasets: [{
            data: vendorValues,
            backgroundColor: [
                'rgba(34, 211, 238, 0.8)',
                'rgba(14, 165, 233, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(147, 51, 234, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(34, 197, 94, 0.8)'
            ],
            borderColor: '#22d3ee',
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    usePointStyle: true
                }
            }
        }
    }
});

// Device Types Chart
const typeData = {{ stats.device_type_breakdown | tojson }};
const typeLabels = Object.keys(typeData);
const typeValues = Object.values(typeData);

new Chart(document.getElementById('typeChart'), {
    type: 'bar',
    data: {
        labels: typeLabels.map(label => label.replace('_', ' ').toUpperCase()),
        datasets: [{
            label: 'Device Count',
            data: typeValues,
            backgroundColor: 'rgba(34, 211, 238, 0.6)',
            borderColor: '#22d3ee',
            borderWidth: 2,
            borderRadius: 5,
            borderSkipped: false
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(34, 211, 238, 0.1)'
                }
            },
            x: {
                grid: {
                    color: 'rgba(34, 211, 238, 0.1)'
                }
            }
        }
    }
});
</script>
{% endblock %}